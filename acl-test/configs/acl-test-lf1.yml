---
interface:
  # server2
  - name: ethernet-1/1
    admin-state: enable
    vlan-tagging: true
    subinterface:
      - index: 0
        type: bridged
        admin-state: enable
        vlan:
          encap:
            untagged: {}
  - name: ethernet-1/2
    admin-state: enable
    vlan-tagging: true
    subinterface:
      - index: 0
        type: bridged
        admin-state: enable
        vlan:
          encap:
            untagged: {}
  # spine
  - name: ethernet-1/49
    admin-state: enable
    subinterface:
      - index: 0
        ipv4:
          admin-state: enable
          address:
            - ip-prefix: 192.168.11.1/30
  # loopback
  - name: system0
    admin-state: enable
    subinterface:
      - index: 0
        ipv4:
          admin-state: enable
          address:
            - ip-prefix: 10.0.0.1/32
  # anycastgw
  - name: irb1
    admin-state: enable
    subinterface:
      - index: 0
        admin-state: enable
        ipv4:
          admin-state: enable
          address:
            - ip-prefix: 192.168.1.254/24
              anycast-gw: true
          arp:
            learn-unsolicited: true
            evpn:
              advertise:
                - route-type: dynamic
            host-route:
              populate:
                - route-type: static
                  datapath-programming: true
                - route-type: dynamic
                  datapath-programming: true
        anycast-gw:
          virtual-router-id: 1
  - name: irb2
    admin-state: enable
    subinterface:
      - index: 0
        admin-state: enable
        ipv4:
          admin-state: enable
          address:
            - ip-prefix: 192.168.2.254/24
              anycast-gw: true
          arp:
            learn-unsolicited: true
            evpn:
              advertise:
                - route-type: dynamic
            host-route:
              populate:
                - route-type: static
                  datapath-programming: true
                - route-type: dynamic
                  datapath-programming: true
        anycast-gw:
          virtual-router-id: 2

tunnel-interface:
  - name: vxlan1
    vxlan-interface:
      - index: 1
        type: bridged
        ingress:
          vni: 1
      - index: 2
        type: bridged
        ingress:
          vni: 2
      - index: 10001
        type: routed
        ingress:
          vni: 10001
        egress:
          source-ip: use-system-ipv4-address
      - index: 10002
        type: routed
        ingress:
          vni: 10002
        egress:
          source-ip: use-system-ipv4-address

routing-policy:
  policy:
    - name: all
      default-action:
        policy-result: accept

network-instance:
  - name: default
    interface:
      - name: ethernet-1/49.0
      - name: system0.0
    protocols:
      bgp:
        autonomous-system: 101
        router-id: 10.0.0.1
        afi-safi:
          - afi-safi-name: ipv4-unicast
            admin-state: enable
        group:
          - group-name: eBGP-underlay
            export-policy: all
            import-policy: all
            peer-as: 201
            afi-safi:
              - afi-safi-name: ipv4-unicast
                admin-state: enable
          - group-name: iBGP-overlay
            export-policy: all
            import-policy: all
            peer-as: 100
            afi-safi:
              - afi-safi-name: evpn
                admin-state: enable
              - afi-safi-name: ipv4-unicast
                admin-state: disable
            local-as:
              as-number: 100
            timers:
              minimum-advertisement-interval: 1
        neighbor:
          - peer-address: 10.0.0.2
            admin-state: enable
            peer-group: iBGP-overlay
            transport:
              local-address: 10.0.0.1
          - peer-address: 192.168.11.2
            peer-group: eBGP-underlay
  - name: l3vrf-1
    type: ip-vrf
    admin-state: enable
    interface:
      - name: irb1.0
    vxlan-interface:
      - name: vxlan1.10001
    protocols:
      bgp-evpn:
        bgp-instance:
          - id: 1
            admin-state: enable
            vxlan-interface: vxlan1.10001
            evi: 10001
      bgp-vpn:
        bgp-instance:
          - id: 1
            route-target:
              export-rt: target:1:10001
              import-rt: target:1:10001
  - name: vrf-1
    type: mac-vrf
    admin-state: enable
    interface:
      - name: ethernet-1/1.0
      - name: irb1.0
    vxlan-interface:
      - name: vxlan1.1
    protocols:
      bgp-evpn:
        bgp-instance:
          - id: 1
            admin-state: enable
            vxlan-interface: vxlan1.1
            evi: 1
      bgp-vpn:
        bgp-instance:
          - id: 1
            route-target:
              export-rt: target:1:1
              import-rt: target:1:1
  - name: l3vrf-2
    type: ip-vrf
    admin-state: enable
    interface:
      - name: irb2.0
    vxlan-interface:
      - name: vxlan1.10002
    protocols:
      bgp-evpn:
        bgp-instance:
          - id: 1
            admin-state: enable
            vxlan-interface: vxlan1.10002
            evi: 10002
      bgp-vpn:
        bgp-instance:
          - id: 1
            route-target:
              export-rt: target:1:10002
              import-rt: target:1:10002
  - name: vrf-2
    type: mac-vrf
    admin-state: enable
    interface:
      - name: ethernet-1/2.0
      - name: irb2.0
    vxlan-interface:
      - name: vxlan1.2
    protocols:
      bgp-evpn:
        bgp-instance:
          - id: 1
            admin-state: enable
            vxlan-interface: vxlan1.2
            evi: 2
      bgp-vpn:
        bgp-instance:
          - id: 1
            route-target:
              export-rt: target:1:2
              import-rt: target:1:2
